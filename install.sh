#!/bin/bash

# –í—ã—Ö–æ–¥–∏–º –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
set -e

# –¶–≤–µ—Ç–∞ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–∏—Å—Ç–µ–º—ã (Hyprland + Apps)...${NC}"

# --------------------------------------------------------------------------
# 1. –°–ü–ò–°–û–ö –ü–ê–ö–ï–¢–û–í
# --------------------------------------------------------------------------
# –ó–¥–µ—Å—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
PACKAGES=(
  # –û—Å–Ω–æ–≤–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
  "stow"
  "git"
  "base-devel"

  # Hyprland –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
  "hyprland"
  "xdg-desktop-portal-hyprland" # –î–ª—è —à–∞—Ä–∏–Ω–≥–∞ —ç–∫—Ä–∞–Ω–∞
  "waybar"                      # –ë–∞—Ä
  "dunst"                       # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–∏–ª–∏ mako)
  "rofi-wayland"                # –ú–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–∏–ª–∏ wofi)
  "slurp"                       # –í—ã–¥–µ–ª–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ (–¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤)
  "grim"                        # –°–∫—Ä–∏–Ω—à–æ—Ç—ã
  "wl-clipboard"                # –ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
  "swww"                        # –û–±–æ–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö, –∏–Ω–∞—á–µ —á–µ—Ä–µ–∑ AUR)
  "polkit-kde-agent"            # –û–∫–Ω–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è (GUI)

  # –¢–µ—Ä–º–∏–Ω–∞–ª –∏ –®–µ–ª–ª
  "foot"
  "fish"
  "starship" # –ü—Ä–æ–º–ø—Ç –¥–ª—è —à–µ–ª–ª–∞
  "fastfetch"

  # Neovim –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤
  "neovim"
  "ripgrep" # –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (Telescope)
  "fd"      # –î–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
  "gcc"     # –î–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ Treesitter
  "npm"     # –î–ª—è LSP —Å–µ—Ä–≤–µ—Ä–æ–≤ (JS/TS)

  # Yazi –∏ –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤
  "yazi"
  "ffmpegthumbnailer" # –ü—Ä–µ–≤—å—é –≤–∏–¥–µ–æ
  "p7zip"             # –ê—Ä—Ö–∏–≤—ã
  "jq"                # JSON
  "poppler"           # –ü—Ä–µ–≤—å—é PDF
  "imagemagick"       # –ü—Ä–µ–≤—å—é –∫–∞—Ä—Ç–∏–Ω–æ–∫
  "zoxide"            # –£–º–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (cd)
  "fzf"               # –ù–µ—á–µ—Ç–∫–∏–π –ø–æ–∏—Å–∫

  # –®—Ä–∏—Ñ—Ç—ã
  "ttf-jetbrains-mono-nerd" # –ì–ª–∞–≤–Ω—ã–π —à—Ä–∏—Ñ—Ç —Å –∏–∫–æ–Ω–∫–∞–º–∏
  "noto-fonts-emoji"        # –≠–º–æ–¥–∑–∏
)

# --------------------------------------------------------------------------
# 2. –£–°–¢–ê–ù–û–í–ö–ê –ü–ê–ö–ï–¢–û–í
# --------------------------------------------------------------------------
echo -e "${BLUE}üì¶ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã...${NC}"

if ! command -v pacman &>/dev/null; then
  echo -e "${YELLOW}‚ö†Ô∏è  Pacman –Ω–µ –Ω–∞–π–¥–µ–Ω. –í—ã –Ω–µ –Ω–∞ Arch Linux? –ü—Ä–æ–ø—É—Å–∫–∞—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–æ–≤.${NC}"
else
  # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π
  sudo pacman -Sy

  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ (–∫–ª—é—á --needed –Ω–µ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å)
  sudo pacman -S --needed --noconfirm "${PACKAGES[@]}"
fi

# --------------------------------------------------------------------------
# 3. –ù–ê–°–¢–†–û–ô–ö–ê –ö–û–ù–§–ò–ì–û–í (STOW)
# --------------------------------------------------------------------------
echo -e "${BLUE}üîó –õ–∏–Ω–∫—É–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ —á–µ—Ä–µ–∑ Stow...${NC}"

# –°–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ –≤ —Ç–≤–æ–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ dotfiles
CONFIGS=(
  "fastfetch"
  "fish"
  "foot"
  "hypr"
  "nvim"
  "waybar"
  "yazi"
  # –î–æ–±–∞–≤—å —Å—é–¥–∞ rofi, dunst –∏–ª–∏ starship, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
)

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –∫–æ–Ω—Ñ–∏–≥–æ–≤, –µ—Å–ª–∏ –Ω–µ—Ç
mkdir -p ~/.config

for folder in "${CONFIGS[@]}"; do
  if [ -d "$folder" ]; then
    # –ë—ç–∫–∞–ø —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    if [ -d "$HOME/.config/$folder" ] && [ ! -L "$HOME/.config/$folder" ]; then
      echo -e "${YELLOW}   ‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ñ–∏–≥ $folder. –ë—ç–∫–∞–ø -> $folder.backup${NC}"
      mv "$HOME/.config/$folder" "$HOME/.config/$folder.backup"
    fi

    # –°–∞–º–∞ –ª–∏–Ω–∫–æ–≤–∫–∞
    stow -t "$HOME/.config" "$folder"
    echo -e "${GREEN}   ‚úÖ $folder –Ω–∞—Å—Ç—Ä–æ–µ–Ω${NC}"
  else
    echo -e "${YELLOW}   ‚ùå –ü–∞–ø–∫–∞ $folder –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ dotfiles (–ø—Ä–æ–ø—É—Å–∫–∞—é)${NC}"
  fi
done

# --------------------------------------------------------------------------
# 4. –§–ò–ù–ê–õ–¨–ù–´–ï –®–¢–†–ò–•–ò
# --------------------------------------------------------------------------

# –°–º–µ–Ω–∞ —à–µ–ª–ª–∞ –Ω–∞ Fish (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å—Ç–æ–∏—Ç)
if [[ $SHELL != */fish ]]; then
  echo -e "${BLUE}üê† –ú–µ–Ω—è—é –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —à–µ–ª–ª –Ω–∞ Fish...${NC}"
  chsh -s "$(which fish)"
fi

echo -e "${GREEN}üéâ –ì–æ—Ç–æ–≤–æ! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Å—å –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–π–¥–∏ –≤ —Å–µ—Å—Å–∏—é Hyprland.${NC}"
